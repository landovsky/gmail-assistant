{"id":"gmail-assistant-0ks","title":"Update README status for manually request a draft","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T16:51:09.81803+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T16:52:36.461179+01:00","closed_at":"2026-02-12T16:52:36.461179+01:00","close_reason":"Closed"}
{"id":"gmail-assistant-36r","title":"Add audit logging to process-invoices command","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T14:16:18.508137+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T14:25:30.727539+01:00","closed_at":"2026-02-12T14:25:30.727539+01:00","close_reason":"Added audit logging section to process-invoices.md matching pattern from other commands"}
{"id":"gmail-assistant-3mn","title":"Investigate unexpectedly long process-inbox duration","description":"Full run took 728s (~12 min). Inbox Triage is the bottleneck at 590s (~10 min).\n\nBreakdown from 2026-02-12 run:\n- Cleanup \u0026 Lifecycle: 100s (reasonable)\n- Inbox Triage: 590s (81% of total — processed 12 emails + cleanup phases)\n- Draft Responses: 38s (reasonable, 1 draft)\n\nKey question: Why does classifying 12 emails + running cleanup phases take ~10 minutes on Haiku?\n\nWrite and commit analysis to docs/, then push.\n\nRaw log:\n[16:53:57] process-inbox started\n[16:53:57-16:55:37] Cleanup: 100s — archived 3, retriaged 1\n[16:55:37-17:05:27] Inbox Triage: 590s — classified 12 emails, detected 1 sent, backfilled 1\n[17:05:27-17:06:05] Draft Responses: 38s — drafted 1\n[17:06:05] finished (728s total)","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T17:09:40.150565+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T18:22:37.540838+01:00","closed_at":"2026-02-12T18:22:37.540838+01:00","close_reason":"Performance analysis complete. Ran all 7 tests, revised bottleneck from searches (6%) to LLM overhead (68%). See docs/INBOX-TRIAGE-PERF-TEST-RESULTS.md"}
{"id":"gmail-assistant-48o","title":"test task","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T15:54:13.122703+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T16:17:56.091849+01:00","closed_at":"2026-02-12T16:17:56.091849+01:00","close_reason":"Closed"}
{"id":"gmail-assistant-4tt","title":"Monitor token usage from operations","description":"Find a way to monitor token usage from the operations (inbox triage, draft response, rework, etc). Track how many tokens each command invocation consumes to understand costs.","status":"open","priority":3,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T15:23:34.209763+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T15:23:34.209763+01:00"}
{"id":"gmail-assistant-4xp","title":"Wire scheduled jobs to app startup (watch renewal + fallback sync)","description":"The WorkerPool processes jobs from the queue, but nothing schedules periodic jobs. Need to: 1) Schedule watch() renewal daily for all active users 2) Schedule fallback full-sync every 15min as safety net 3) Wire these into FastAPI lifespan startup. Options: asyncio tasks with sleep loops, or APScheduler.","status":"open","priority":1,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-13T07:11:57.397304+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:11:57.397304+01:00"}
{"id":"gmail-assistant-59j","title":"test task 3","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T16:23:16.681332+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:10:39.896148+01:00","closed_at":"2026-02-13T07:10:39.896148+01:00","close_reason":"Superseded by v2 architecture"}
{"id":"gmail-assistant-5b9","title":"Detect manually-labeled emails in inbox-triage","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T16:51:07.880274+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T16:52:36.457765+01:00","closed_at":"2026-02-12T16:52:36.457765+01:00","close_reason":"Closed"}
{"id":"gmail-assistant-67y","title":"Set up launchd scheduling for automated runs","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T14:16:16.561782+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T14:25:30.800828+01:00","closed_at":"2026-02-12T14:25:30.800828+01:00","close_reason":"Created launchd plist at config/com.gmail-assistant.process-inbox.plist, fixed bin/process-inbox to use correct claude CLI invocation"}
{"id":"gmail-assistant-6de","title":"Implement admin/watch endpoint and OAuth token bootstrap","description":"Need POST /admin/watch endpoint to register Gmail watch() for a user. Also need a way to bootstrap the first OAuth token (browser flow) since personal_oauth mode requires interactive consent on first run. Currently no way to trigger watch() registration or initial auth from the running server.","status":"open","priority":1,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-13T07:12:00.682954+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:12:00.682954+01:00"}
{"id":"gmail-assistant-7ii","title":"Add incremental processing to inbox triage","description":"Track last-processed timestamp and only scan new emails (Solution 7).\n\nCurrently: newer_than:30d returns 96 results every run\nTarget: after:\u003clast_run_date\u003e returns ~22 results (77% reduction)\n\nApproach:\n1. Store last-processed timestamp in DB (MAX(processed_at) already available)\n2. Convert to Gmail date format (YYYY/MM/DD) for after: filter\n3. Fall back to newer_than:30d on first run or if no timestamp exists\n4. Caveat: Gmail after: has day-level granularity only\n\nMain benefit is fewer emails to read+classify downstream, not faster search.\nCompounds with parallel reads optimization.\n\nSee docs/INBOX-TRIAGE-PERF-TEST-RESULTS.md, Test 7.","status":"closed","priority":1,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-12T18:34:02.251033+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:10:39.893653+01:00","closed_at":"2026-02-13T07:10:39.893653+01:00","close_reason":"Superseded by v2 architecture"}
{"id":"gmail-assistant-7tb","title":"Detect user instructions in existing drafts","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T16:51:08.591029+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T16:52:36.459803+01:00","closed_at":"2026-02-12T16:52:36.459803+01:00","close_reason":"Closed"}
{"id":"gmail-assistant-8y3","title":"Test morning-briefing dashboard generation","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T14:16:19.399097+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T14:30:01.94982+01:00","closed_at":"2026-02-12T14:30:01.94982+01:00","close_reason":"Dashboard generated successfully at data/dashboard.html with summary, action queue, invoice tracker, and waiting sections"}
{"id":"gmail-assistant-959","title":"Test harder prompt injection vectors in draft responder","description":"HTML comment and fake compliance template injections were both blocked. Try more subtle vectors: Unicode directional overrides, Czech-language instructions woven naturally into email body, invisible characters, or other steganographic techniques. Goal: find if any vector can influence the draft responder's output.","status":"open","priority":3,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T15:46:16.202525+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T15:46:16.202525+01:00"}
{"id":"gmail-assistant-9o7","title":"Parallelize email reads during inbox triage","description":"Biggest single optimization from perf test results (Solution 4).\n\nCurrently: 12 emails read sequentially at ~6s each = ~83s\nTarget: All reads in parallel = ~6s (93% savings)\n\nApproach:\n1. Run Phase B search to get list of unclassified emails\n2. Read all emails in parallel (safe: 14/400 API rate = 4%)\n3. Present batch to LLM for classification\n4. Batch-apply labels via batch_modify_emails\n\nSee docs/INBOX-TRIAGE-PERF-TEST-RESULTS.md, Test 4.","status":"closed","priority":1,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-12T18:33:56.322281+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:10:39.89499+01:00","closed_at":"2026-02-13T07:10:39.89499+01:00","close_reason":"Superseded by v2 architecture"}
{"id":"gmail-assistant-cd5","title":"Create Gmail labels via MCP","status":"closed","priority":1,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T13:13:54.912851+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T13:16:11.537705+01:00","closed_at":"2026-02-12T13:16:11.537705+01:00","close_reason":"Created all 8 labels in Gmail, saved IDs to config/label_ids.yml","dependencies":[{"issue_id":"gmail-assistant-cd5","depends_on_id":"gmail-assistant-q3x","type":"blocks","created_at":"2026-02-12T13:13:59.071212+01:00","created_by":"Tomáš Landovský"}]}
{"id":"gmail-assistant-dmz","title":"test task 2","status":"closed","priority":2,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T16:18:00.860019+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:10:39.897215+01:00","closed_at":"2026-02-13T07:10:39.897215+01:00","close_reason":"Superseded by v2 architecture"}
{"id":"gmail-assistant-lqp","title":"Extract DB operations into a CLI API layer","description":"## Problem\n\nAll ~21 SQL operations live as inline `sqlite3` commands inside markdown prompt files. Claude constructs and executes them via Bash during each run. This means:\n\n- Every SQL statement is a suggestion — the LLM might subtly deviate (wrong column, missing updated_at, forgetting the audit log)\n- Audit trail relies on the LLM remembering to INSERT into email_events alongside every UPDATE\n- SQL templates consume meaningful prompt space across 4+ command files\n- Changing a column or adding a field means updating 4+ markdown files\n- No way to unit-test DB operations independently\n\n## Proposal\n\nBuild a lightweight CLI wrapper (`bin/gma-db`) that encapsulates all DB operations:\n\n```\ngma-db classify \u003cthread_id\u003e --classification=... --reasoning=... --language=... --style=...\ngma-db mark-drafted \u003cthread_id\u003e --draft-id=...\ngma-db mark-archived \u003cthread_id\u003e --reason=\"...\"\ngma-db mark-skipped \u003cthread_id\u003e\ngma-db rework \u003cthread_id\u003e --draft-id=... --instruction=\"...\"\ngma-db log-event \u003cthread_id\u003e --event=sent_detected --detail=\"...\"\ngma-db get-pending --classification=needs_response\ngma-db get-active\ngma-db get-thread \u003cthread_id\u003e\ngma-db backfill \u003cthread_id\u003e --message-id=... --sender=... --subject=...\n```\n\nEach command handles the SQL + audit log atomically in a single transaction.\n\n## Benefits\n\n1. **Correctness guarantees** — operations are atomic and correct by construction, not by LLM interpretation\n2. **Audit consistency** — mutation + audit log bundled in a single transaction; can't forget the audit entry\n3. **Smaller prompts** — replace multi-line SQL blocks with one-liner CLI calls, freeing context budget\n4. **Easier schema evolution** — change one implementation, interface stays stable\n5. **Testability** — unit-test DB operations independently without running Claude\n\n## Tradeoffs\n\n- Loses some ad-hoc query flexibility (mostly a feature, not a bug)\n- New code to maintain (though replaces equivalent complexity in prompts)\n- Another dependency in the pipeline\n\n## Current State (for reference)\n\n- 2 tables: `emails` (state) + `email_events` (audit)\n- 4 SELECT, 10 INSERT, 4 UPDATE operations across 4 command files\n- All executed via `sqlite3 data/inbox.db \"...\"` in Bash\n- Commands: inbox-triage, draft-response, cleanup, rework-draft, morning-briefing","status":"closed","priority":3,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-12T17:06:44.919156+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:10:39.898317+01:00","closed_at":"2026-02-13T07:10:39.898317+01:00","close_reason":"Superseded by v2 architecture"}
{"id":"gmail-assistant-ndk","title":"Test rework-draft flow end-to-end","status":"closed","priority":1,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T14:16:17.615266+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T14:30:02.070785+01:00","closed_at":"2026-02-12T14:30:02.070785+01:00","close_reason":"Rework-draft step validated (no-op when no Rework-labeled emails). Full end-to-end test requires a real rework scenario which needs mobile user interaction."}
{"id":"gmail-assistant-ols","title":"Implement draft-response command (business style)","status":"closed","priority":1,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-12T13:13:55.114983+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T13:22:32.972941+01:00","closed_at":"2026-02-12T13:22:32.972941+01:00","close_reason":"Created .claude/commands/draft-response.md with business style, rework marker, label transitions","dependencies":[{"issue_id":"gmail-assistant-ols","depends_on_id":"gmail-assistant-voq","type":"blocks","created_at":"2026-02-12T13:13:59.263027+01:00","created_by":"Tomáš Landovský"}]}
{"id":"gmail-assistant-q3x","title":"Scaffold project structure, schema, and config files","status":"closed","priority":1,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T13:13:51.895923+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T13:15:49.245215+01:00","closed_at":"2026-02-12T13:15:49.245215+01:00","close_reason":"Created directories, schema.sql, inbox.db, communication_styles.yml, contacts.yml, updated .gitignore"}
{"id":"gmail-assistant-voq","title":"Implement inbox-triage command","status":"closed","priority":1,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-12T13:13:55.023199+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T13:22:32.909693+01:00","closed_at":"2026-02-12T13:22:32.909693+01:00","close_reason":"Created .claude/commands/inbox-triage.md with Phase A lifecycle + Phase B classification","dependencies":[{"issue_id":"gmail-assistant-voq","depends_on_id":"gmail-assistant-q3x","type":"blocks","created_at":"2026-02-12T13:13:59.147153+01:00","created_by":"Tomáš Landovský"},{"issue_id":"gmail-assistant-voq","depends_on_id":"gmail-assistant-cd5","type":"blocks","created_at":"2026-02-12T13:13:59.207815+01:00","created_by":"Tomáš Landovský"}]}
{"id":"gmail-assistant-wk6","title":"Eliminate subject-based thread lookups in Done cleanup","description":"Use Thread ID directly instead of searching by subject (Solution 2).\n\nCurrently: Done cleanup searches subject:\"\u003cexact subject\u003e\" then reads ALL results\nand filters by Thread ID. For recurring subjects (e.g. \"ADMIN: chybí denní importy\"),\nthis returns 20 results across 20 threads — 95% wasted reads.\n\nTarget: Skip the subject search entirely, use Thread ID from initial read_email.\n\nApproach:\n1. read_email already returns Thread ID as a first-class field\n2. In Done cleanup, use Thread ID to identify thread messages (no subject search)\n3. Update .claude/commands/inbox-triage.md and .claude/commands/cleanup.md\n\nSee docs/INBOX-TRIAGE-PERF-TEST-RESULTS.md, Test 2.","status":"closed","priority":1,"issue_type":"feature","owner":"landovsky@gmail.com","created_at":"2026-02-12T18:36:49.610732+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-13T07:10:39.89161+01:00","closed_at":"2026-02-13T07:10:39.89161+01:00","close_reason":"Superseded by v2 architecture"}
{"id":"gmail-assistant-y4d","title":"Create bin/process-inbox orchestration script","status":"closed","priority":1,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T13:13:55.20498+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T13:22:33.029378+01:00","closed_at":"2026-02-12T13:22:33.029378+01:00","close_reason":"Created bin/process-inbox orchestration script with --model flags, also created rework-draft, process-invoices, morning-briefing commands","dependencies":[{"issue_id":"gmail-assistant-y4d","depends_on_id":"gmail-assistant-q3x","type":"blocks","created_at":"2026-02-12T13:13:59.318004+01:00","created_by":"Tomáš Landovský"}]}
{"id":"gmail-assistant-z52","title":"Validate end-to-end pipeline run (bin/process-inbox)","status":"closed","priority":1,"issue_type":"task","owner":"landovsky@gmail.com","created_at":"2026-02-12T14:16:15.838194+01:00","created_by":"Tomáš Landovský","updated_at":"2026-02-12T14:29:55.817816+01:00","closed_at":"2026-02-12T14:29:55.817816+01:00","close_reason":"All 5 pipeline steps validated: triage (17 new emails classified), draft (no-op), rework (no-op), invoices (permission issue fixed), briefing (dashboard generated). Fixed bin/process-inbox to use claude -p /command syntax with --allowedTools."}

#!/usr/bin/env bash
# Delete AI-generated drafts (identified by rework marker ✂️).
# Usage:
#   bin/cleanup-drafts              # dry run, first user
#   bin/cleanup-drafts delete       # actually delete, first user
#   bin/cleanup-drafts 1 delete     # actually delete, user ID 1
set -euo pipefail

# If first arg is "delete" or "dry_run", treat it as mode (no user_id)
if [[ "${1:-}" =~ ^(delete|dry_run)$ ]]; then
  MODE="$1"
  USER_ID=""
else
  USER_ID="${1:-}"
  MODE="${2:-dry_run}"
fi

if [ "$USER_ID" = "" ]; then
  bundle exec rake "gmail:cleanup_drafts[,${MODE}]"
else
  bundle exec rake "gmail:cleanup_drafts[${USER_ID},${MODE}]"
fi
